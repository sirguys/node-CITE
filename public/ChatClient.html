<!DOCTYPE html>
<html>
    <head>
        <title>Let's Chat</title>
        <meta charset="UTF-8"/>
        <script src="js/jquery-3.1.1.min.js"></script>
        <script src="js/socket.io.js"></script>
        <style>
            #log{
                width: 500px;
                height: 250px;
                border: 1px solid #000;
                padding: 4px;
                overflow: scroll;
            }
            #friends, #main {
                display:inline-block;
                vertical-align: top;
            }
            #friends {
                width: 200px;
            }
        </style>
    </head>
    <body>
        <div id="regis">
            <input type="text"/> <button>Register</button>
        </div>
        <h3 id="chatID"></h3>
        <ul id="friends"></ul>
        <div id="main">
            <div id="log"></div>
            <input type="text" id="msg"/> <button>Submit</button>
        </div>
        <script>
            let chatID;
            let socket = io();
            socket.on('re-regis', (data)=>{
                chatID = $('#regis input').val();
                if(data) {
                    $('#regis').hide();
                    $('h3').html(chatID);
                    socket.on('update', (data)=>{
                        let $friends = $('#friends').empty();
                        for(let f of data) $friends.append(`<li>${f}</li>`);
                    });
                    socket.on('chat', (data)=>{
                        const $log = $('#log');
                        $log.append(`<b>${data.id}</b> ${data.msg}<br/>`);
                        $log.scrollTop($log[0].scrollHeight);
                    });
                }
                else alert(chatID + " error");
            });
            $('#regis button').on('click', ()=>{
                socket.emit('regis', $('#regis input').val());
            });
            $('#main button').on('click', ()=>{
                socket.emit('chat', {id: chatID, msg: $('#msg').val()});
            });
        </script>
    </body>
</html>
